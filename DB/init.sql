DROP DATABASE IF EXISTS book_review;

CREATE DATABASE book_review;

USE book_review;

CREATE TABLE `user` (UID BIGINT NOT NULL AUTO_INCREMENT, EMAIL VARCHAR(255), USERNAME VARCHAR(255), PASS VARCHAR(255), PRIMARY KEY (UID));

CREATE TABLE `comment` (COMMENTID BIGINT NOT NULL AUTO_INCREMENT, CONTENT VARCHAR(255), 
`TIMESTAMP` DATETIME, USER_UID BIGINT, POST_POSTID BIGINT, PRIMARY KEY (COMMENTID));

CREATE TABLE `post` (POSTID BIGINT NOT NULL AUTO_INCREMENT, BOOK_TITLE VARCHAR(255), BOOK_AUTHOR VARCHAR(255), PATH VARCHAR(255), REVIEW VARCHAR(255),
`TIMESTAMP` DATETIME, USER_UID BIGINT, `VIEW` BIGINT, PRIMARY KEY (POSTID));

CREATE TABLE `category` (CATEGORYID BIGINT NOT NULL AUTO_INCREMENT, CATEGORY VARCHAR(255), PRIMARY KEY (CATEGORYID));

CREATE TABLE `rate`(RATEID BIGINT NOT NULL AUTO_INCREMENT, USER_UID BIGINT, POST_POSTID BIGINT, 
PRIMARY KEY (RATEID));

CREATE TABLE `join_post_category` (
POST_POSTID BIGINT,
CATEGORY_CATEGORYID BIGINT,
CONSTRAINT FK_JOIN_POST_CATEGORY_POST_POSTID FOREIGN KEY (POST_POSTID) REFERENCES post(POSTID),
CONSTRAINT FK_JOIN_POST_CATEGORY_CATEGORY_CATEGORYID FOREIGN KEY (CATEGORY_CATEGORYID) REFERENCES category(CATEGORYID));

ALTER TABLE `comment` 
ADD CONSTRAINT FK_COMMENT_USER_UID FOREIGN KEY(USER_UID) REFERENCES `user`(UID),
ADD CONSTRAINT FK_COMMENT_POST_POSTID FOREIGN KEY (POST_POSTID) REFERENCES post(POSTID);

ALTER TABLE `post` 
ADD CONSTRAINT FK_POST_USER_UID FOREIGN KEY (USER_UID) REFERENCES `user`(UID);

ALTER TABLE `rate` 
ADD CONSTRAINT FK_RATE_USER_UID FOREIGN KEY (USER_UID) REFERENCES `user`(UID), 
ADD CONSTRAINT FK_RATE_POST_POSTID FOREIGN KEY (POST_POSTID) REFERENCES post(POSTID);

INSERT INTO `user` VALUE (NULL, "user1@gmailcom","user1", "123456");
INSERT INTO `user` VALUE (NULL, "user2@gmailcom","user2", "123456");


INSERT INTO `category` VALUE (NULL, "fiction");
INSERT INTO `category` VALUE (NULL, "novel");
INSERT INTO `category` VALUE (NULL, "travel");
INSERT INTO `category` VALUE (NULL, "guide");
INSERT INTO `category` VALUE (NULL, "horror");
INSERT INTO `category` VALUE (NULL, "romance");
INSERT INTO `category` VALUE (NULL, "science");
INSERT INTO `category` VALUE (NULL, "others");

INSERT INTO `post` VALUE (NULL, "GMAT", "author1", "./images/gmat.jpeg","review1",'2013-08-05 18:19:03', 2, 123);
INSERT INTO `post` VALUE (NULL, "Clean Code", "author1", "./images/gmat.jpeg","review1",'2013-08-05 18:19:03', 1, 23);
INSERT INTO `post` VALUE (NULL, "CSS and HTML", "author1", "./images/gmat.jpeg","review1",'2013-08-05 18:19:03', 2, 999);
INSERT INTO `post` VALUE (NULL, "Book Marketing", "author1", "./images/gmat.jpeg","review1",'2013-08-05 18:19:03', 1, 1);
INSERT INTO `post` VALUE (NULL, "JavaScript", "author1", "./images/gmat.jpeg","review1",'2013-08-05 18:19:03', 1, 46);

INSERT INTO `rate` VALUE (NULL, 1, 1);
INSERT INTO `rate` VALUE (NULL, 1, 2);
INSERT INTO `rate` VALUE (NULL, 1, 3);
INSERT INTO `rate` VALUE (NULL, 2, 1);
INSERT INTO `rate` VALUE (NULL, 2, 2);